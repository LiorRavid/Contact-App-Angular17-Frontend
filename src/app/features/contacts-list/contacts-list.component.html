<main class="main-content">
    <div class="contacts-container">
        @if (contactsState.isLoading() && contactsState.allContacts().length === 0) {
        <div class="loading-overlay">
            <app-loading-spinner></app-loading-spinner>
        </div>
        } @else {
        <div class="contacts-list">
            @for (contact of contactsState.filteredContacts(); track contact.id; let first = $first) {
            @if (first) {
            <app-contact-card [contact]="contact" (onEdit)="editContact($event)" (onDelete)="deleteContact($event)">
            </app-contact-card>
            } @else {
            @defer (on viewport) {
            <app-contact-card [contact]="contact" (onEdit)="editContact($event)" (onDelete)="deleteContact($event)">
            </app-contact-card>
            } @placeholder {
            <div class="card-skeleton"></div>
            }
            }
            } @empty {
            @if (!contactsState.isLoading()) {
            <div class="no-results">
                <mat-icon>search_off</mat-icon>
                <p>No contacts found matching your search.</p>
            </div>
            }
            }
        </div>

        @if (contactsState.allContacts().length > 0) {
        <div class="scroll-trigger-container">
            @if (contactsState.isLoading()) {
            <div class="scroll-loading">
                <app-loading-spinner></app-loading-spinner>
            </div>
            }

            @defer (on viewport) {
            <app-scroll-trigger (triggered)="handleInfiniteScroll()"></app-scroll-trigger>
            } @placeholder {
            <div class="scroll-anchor"></div>
            }
        </div>
        }
        }
    </div>
</main>

<button mat-fab color="primary" class="add-button" (click)="addContact()" aria-label="Add new contact">
    <mat-icon>add</mat-icon>
</button>