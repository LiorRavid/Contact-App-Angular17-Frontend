<div class="form-container">
    <mat-card class="contact-card">
        <mat-card-header>
            <mat-card-title>{{ isEditMode() ? 'Edit Contact' : 'Add New Contact' }}</mat-card-title>
            <mat-card-subtitle>Enter the contact's details below</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
            <form [formGroup]="contactForm" (ngSubmit)="onSubmit()" class="contact-form">
                <div class="form-row">
                    <mat-form-field appearance="outline">
                        <mat-label>First Name</mat-label>
                        <input matInput formControlName="firstName" placeholder="e.g. John">
                        @if (contactForm.get('firstName')?.invalid && contactForm.get('firstName')?.touched) {
                        <mat-error>{{ getErrorMessage('firstName') }}</mat-error>
                        }
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                        <mat-label>Last Name</mat-label>
                        <input matInput formControlName="lastName" placeholder="e.g. Doe">
                        @if (contactForm.get('lastName')?.invalid && contactForm.get('lastName')?.touched) {
                        <mat-error>{{ getErrorMessage('lastName') }}</mat-error>
                        }
                    </mat-form-field>
                </div>

                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Email Address</mat-label>
                    <input matInput formControlName="email" placeholder="e.g. john.doe@example.com" type="email">
                    <mat-icon matSuffix color="primary">email</mat-icon>
                    @if (contactForm.get('email')?.invalid && contactForm.get('email')?.touched) {
                    <mat-error>{{ getErrorMessage('email') }}</mat-error>
                    }
                </mat-form-field>

                <div class="form-row">
                    <mat-form-field appearance="outline">
                        <mat-label>Phone Number</mat-label>
                        <input matInput formControlName="phone" placeholder="e.g. 050-1234567">
                        <mat-icon matSuffix color="primary">phone</mat-icon>
                        @if (contactForm.get('phone')?.invalid && contactForm.get('phone')?.touched) {
                        <mat-error>{{ getErrorMessage('phone') }}</mat-error>
                        }
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                        <mat-label>Mobile (Cell)</mat-label>
                        <input matInput formControlName="cell" placeholder="e.g. 054-1234567">
                        <mat-icon matSuffix color="primary">smartphone</mat-icon>
                    </mat-form-field>
                </div>

                <div class="image-upload-section">
                    <div class="avatar-preview-container" (click)="fileInput.click()">
                        <app-avatar [src]="contactForm.value.picture" [firstName]="contactForm.value.firstName"
                            [lastName]="contactForm.value.lastName" [size]="120">
                        </app-avatar>
                        <div class="upload-overlay">
                            <mat-icon>camera_alt</mat-icon>
                            <span>Change Photo</span>
                        </div>
                    </div>
                    <input #fileInput type="file" hidden (change)="onFileSelected($event)" accept="image/*">
                    <div class="upload-info">
                        <h3>Contact Photo</h3>
                        <p>Select a photo for your contact</p>
                        <button mat-stroked-button type="button" color="primary" class="upload-btn"
                            (click)="fileInput.click()">
                            <mat-icon>upload</mat-icon>
                            Upload from computer
                        </button>
                    </div>
                </div>

                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Avatar Image URL</mat-label>
                    <input matInput formControlName="picture" placeholder="https://example.com/photo.jpg">
                    <mat-icon matSuffix color="primary">image</mat-icon>
                    <mat-hint>Paste a URL or upload a file above</mat-hint>
                </mat-form-field>

                <div class="actions">
                    <button mat-button type="button" (click)="onCancel()" [disabled]="isSubmitting()">Cancel</button>
                    <button mat-flat-button color="primary" type="submit"
                        [disabled]="contactForm.invalid || isSubmitting()">
                        @if (isSubmitting()) {
                        <mat-icon class="spinning">sync</mat-icon>
                        } @else {
                        <mat-icon>{{ isEditMode() ? 'save' : 'person_add' }}</mat-icon>
                        }
                        {{ isEditMode() ? 'Update Contact' : 'Create Contact' }}
                    </button>
                </div>
            </form>
        </mat-card-content>
    </mat-card>
</div>